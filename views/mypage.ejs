<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <!-- ë‚´ ì»¤ìŠ¤í…€ cssíŒŒì¼ ì²¨ë¶€ -->
    <link rel="stylesheet" href="/public/main.css">
  </head>
  <body>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- nav.htmlì„ ì²¨ë¶€. -->
    <%- include("nav.html") %>
    <pre>
      <h1 class="text-center">My Page</h1>
      <h6 class="text-center">ë‚´ê°€ ì‘ì„±í•œ ê¸€ì˜ ìˆ˜ì • ë° ì‚­ì œë¥¼ í•  ìˆ˜ ìˆì–´ìš”ğŸ˜</h6>
    </pre>
    

    <p class="text-center">id: <%= userInfo.id %> </p>
    <!-- <p class="text-center">pw: <%= userInfo.pw %></p> -->
    <p class="text-center">ë‹‰ë„¤ì„: <%= userInfo.username%></p>
    
    
    <form action="/logout", method="post" class="text-center">
      <button type="submit" class="btn btn-outline-danger" >Log out</button> 
      <pre>

        
      </pre>
      <h1 class="text-center">ë‚´ê°€ ì‘ì„±í•œ ê¸€</h1>
  </form>
    <div class="container mt-4">  
      <ul class="list-group">
        <% for (let i = 0; i < posts.length; i++) { %>
        <li class="list-group-item">
          <p>ë‹‰ë„¤ì„: <%= posts[i].username %></p>
          <h4>ë‹¨ì–´: <%= posts[i].world[0] %></h4>
          <h4>ëœ»: <%= posts[i].meaning[0] %></h4>
          <p></p>
          <h4>ë‹¨ì–´: <%= posts[i].world[1] %></h4>
          <h4>ëœ»: <%= posts[i].meaning[1] %></h4>
          <p></p>
          <h4>ë‹¨ì–´: <%= posts[i].world[2] %></h4>
          <h4>ëœ»: <%= posts[i].meaning[2] %></h4>
          <p></p>
          <p><%= posts[i].dateToString %></p>
          
          <button class="btn btn-outline-danger delete" data-id="<%= posts[i]._id %>">Delete</button>
          <button class="btn btn-outline-success" data-id="<%= posts[i]._id %>" onclick="location.href='/edit/<%= posts[i]._id %>'">Modify</button>
          <button type="button" data-id="<%= posts[i].username %>" onclick="location.href='/chatroom'" class="btn btn-outline-secondary chat">ì±„íŒ…í•˜ê¸°</button>
        </li>
        <% } %>
      </ul>
    </div>
    <!-- ì‚­ì œìš”ì²­ AJAX ì‘ì„±(with JQuery ë¬¸ë²•) -->
    <script>
      // ajax ê¸°ë³¸ ë¬¸ë²•
      // deleteë²„íŠ¼ ëˆ„ë¥¼ë•Œë§Œ ì„œë²„ì— deleteìš”ì²­í•˜ëŠ” ì½”ë“œ.
      $('.delete').click( function(e) {
        var number = e.target.dataset.id      //event.tartget ì€ ì‹¤ì œë¡œ ë‚´ê°€ í´ë¦­í•œ ìš”ì†Œ + ìˆ¨ê²¨ì ¸ìˆëŠ” data-id ë¥¼ numberë³€ìˆ˜ì— ì €ì¥í•˜ë¼.
        var currently = $(this)

        // ì„œë²„ì— ìƒˆë¡œê³ ì¹¨ ì—†ì´ DELTEìš”ì²­ í•  êº¼ì—ìš”~
        $.ajax({
          method : "DELETE",
          url: "/delete",
          data: { _id: number}
        }).done(function(result) {         // ìš”ì²­ ì„±ê³µì‹œ ì‹¤í–‰í•  ì½”ë“œ.
          // í˜ì´ì§€ë¥¼ ê°•ì œë¡œ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”
          // ë˜ëŠ”, ì‚­ì œë²„íŠ¼ì„ ëˆ„ë¥¸ <li>ìš”ì†Œë¥¼ ì œê±°í•´ì£¼ì„¸ìš”/ì•ˆë³´ì´ê²Œ
          currently.parent('li').fadeOut()    // parent(): ~ì˜ ë¶€ëª¨íƒœê·¸ë¥¼ ì°¾ì•„ì£¼ì…ˆ!,  fadeOut(): ì„œì„œíˆ ì‚¬ë¼ì§€ê²Œ í•´ë‹¬ë¼!
          
        }).fail((xhr, textStatus, errorThrown ) => {   // ìš”ì²­ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í•  ì½”ë“œ.
          console.log("Something went wrongğŸ¤”")
          console.log(xhr, textStatus, errorThrown)
        })
      })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <%- include("footer.html") %>
  </body>
</html>